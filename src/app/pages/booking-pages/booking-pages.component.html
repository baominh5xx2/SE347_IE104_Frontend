<div class="w-full booking-pages">
  <div class="container mx-auto p-6 flex gap-4">

    <div class="flex flex-col gap-4">
      @if (successMessage) {
        <div class="bg-green-50 border-2 border-green-500 rounded-lg p-4 shadow-lg">
          <div class="flex items-center gap-3">
            <div class="flex-shrink-0">
              <svg class="w-6 h-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
              </svg>
            </div>
            <p class="text-green-800 font-semibold">{{ successMessage }}</p>
          </div>
        </div>
      }

      <div class="bg-white rounded-lg shadow-md p-4">
        <h2 class="text-xl font-bold mb-4">Thông tin người đặt</h2>
        <p class="text-gray-600 mb-4">Vui lòng điền đầy đủ thông tin để đảm bảo bạn có thể nhận được voucher xác nhận đặt tour qua email đã cung cấp.</p>

        @if (isLoading && !tourPackage) {
          <div class="flex justify-center items-center py-12">
            <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"></div>
          </div>
        } @else if (errorMessage && !tourPackage) {
          <div class="bg-red-50 border border-red-200 rounded-lg p-4">
            <p class="text-red-800">{{ errorMessage }}</p>
          </div>
        } @else {
          <form (ngSubmit)="submitForm()">
            @if (errorMessage) {
              <div class="mb-4 bg-red-50 border border-red-200 rounded-lg p-4">
                <p class="text-red-800 text-sm">{{ errorMessage }}</p>
              </div>
            }

            <!-- Number of People -->
            <div class="mb-4">
              <label for="numberOfPeople" class="block text-gray-700 mb-2">Số người</label>
              <input 
                type="number" 
                id="numberOfPeople" 
                [(ngModel)]="numberOfPeople" 
                name="numberOfPeople" 
                required 
                min="1"
                (ngModelChange)="onNumberOfPeopleChange()"
                class="mt-1 block w-full border border-gray-300 rounded-md p-2" 
                placeholder="Nhập số người">
            </div>

            <!-- Full Name -->
            <div class="mb-4">
              <label for="fullName" class="block text-gray-700">Họ và tên người liên hệ</label>
              <input type="text" id="fullName" [(ngModel)]="fullName" name="fullName" required class="mt-1 block w-full border border-gray-300 rounded-md p-2" placeholder="Nhập họ và tên">
            </div>

            <!-- Email -->
            <div class="mb-4">
              <label for="email" class="block text-gray-700">Email</label>
              <input type="email" id="email" [(ngModel)]="email" name="email" required class="mt-1 block w-full border border-gray-300 rounded-md p-2" placeholder="Nhập email">
            </div>

            <!-- Phone Number -->
            <div class="mb-4">
              <label for="phoneNumber" class="block text-gray-700">Số điện thoại</label>
              <div class="flex">
                <input type="text" class="w-1/4 border border-gray-300 rounded-md p-2" value="+84" readonly>
                <input type="text" id="phoneNumber" [(ngModel)]="phoneNumber" name="phoneNumber" required class="w-full border border-gray-300 rounded-md p-2 ml-2" placeholder="Nhập số điện thoại">
              </div>
            </div>

          </form>
        }
      </div>

       <!-- Special Requests Card -->
      <div class="bg-white rounded-lg shadow-md p-4">
        <h3 class="text-lg font-bold mb-2">Yêu cầu đặc biệt (tùy chọn)</h3>
        <p class="text-gray-600 mb-4">Cho chúng tôi biết nếu bạn có yêu cầu đặc biệt nào khác.</p>

        <textarea 
          [(ngModel)]="specialRequests"
          name="specialRequests"
          rows="4"
          class="w-full border border-gray-300 rounded-md p-2"
          placeholder="Nhập yêu cầu đặc biệt của bạn..."></textarea>
      </div>

      <!-- price detail -->
      <div class="bg-white rounded-lg shadow-md p-4">
        <h2 class="text-xl font-bold mb-4">Chi tiết giá</h2>
        <p class="text-blue-500 mb-4">Đăng nhập ngay và tận hưởng mã giảm giá đặc biệt dành cho người dùng mới, bạn có thể tiết kiệm lên đến 1.000.000đ cho đơn đặt phòng đầu tiên.</p>

        <div class="mb-4">
          <p class="flex justify-between">
            <span>Giá tour ({{ numberOfPeople }} người)</span>
            <span>{{ formatPrice(priceBreakdown.roomPrice) }}</span>
          </p>
          @if (priceBreakdown.roomDescription) {
            <p class="text-sm text-gray-600 mt-1">
              {{ priceBreakdown.roomDescription }}
            </p>
          }
        </div>

        <div class="border-t border-gray-300 mt-4 pt-2">
          <p class="flex justify-between font-bold text-lg">
            <span>Tổng giá</span>
            <span class="text-blue-600">{{ formatPrice(priceBreakdown.totalPrice) }}</span>
          </p>
        </div>

        <p class="text-orange-500 text-sm my-4">Bạn không cần thanh toán gì ngay bây giờ!</p>

        <button 
          (click)="proceedToPayment()" 
          [disabled]="isLoading"
          class="bg-orange-500 text-white rounded-md py-2 px-4 w-full hover:bg-orange-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors">
          {{ isLoading ? 'Đang xử lý...' : 'Đặt tour ngay' }}
        </button>
      </div>

    </div>



    <div class="flex-auto w-1/3 m-w31 flex flex-col gap-4">
      <app-booking-card [tourPackage]="tourPackage" [numberOfPeople]="numberOfPeople"></app-booking-card>
      <app-cancellation-policy></app-cancellation-policy>
    </div>
  </div>
</div>

